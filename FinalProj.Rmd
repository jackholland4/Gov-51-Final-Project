---
output:
  pdf_document: default
  html_document: default
---

The Effect of Natural Disasters on Incumbent Support
---
*Authored by Jack Holland, Jenny Le, and Menemsha Solomon*

Research Question: How does a natural disaster affect candidate performance?
---
___

Experimental Design:
---

**Treatment Variable**: Exposure to Hurricane Sandy (i.e. a certain threshold of property damage as assessed by disaster relief)
  - Threshold will be decided upon looking at hurricane damage data set
  - *Data set*: Sandy Damage Estimates by Block Group

**Outcome Variable**: 2008-2012 Election Trend
  - (2012 election D margin - 2008 election D margin) - (Nationwide D swing [-3.3])

**Constants**: Demographic Data
  - Needs to be disaggregated into block data for merging
    - https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/T9VMJO
    - Also helpful for sourcing data: https://davesredistricting.org/maps#aboutdata \

The first step of this process is to find and aggregate official election results by precinct from both 2008 and 2012. Unfortunately, there exists no centralized data set for either of these elections, so we must acquire them on an individual basis and then clean and merge them.

#Precinct-Level Election Returns
```{r}
#CONNECTICUT
ct_2008 <- read.csv("20081104__ct__general__town.csv")
ct_2012 <- read.csv("20121106__ct__general__precinct.csv")

##Cleaning 2008 data
ct_2008 <- subset(ct_2008, office == "President")
ct_2008 <- subset(ct_2008, candidate == "Barack Obama" | candidate == "John McCain")
ct_2008 <- subset(ct_2008, county != "Total")
ct_2008 <- ct_2008[, c(2, 3, 5, 6, 7)]
ct_2008$party <- ifelse(ct_2008$party == "Dem", "DEM", "REP")

##Cleaning 2012 data
ct_2012 <- subset(ct_2012, office == "President")
ct_2012 <- subset(ct_2012, candidate == "Barack Obama" | candidate == "Mitt Romney")
ct_2012 <- aggregate(votes ~ town + candidate + party + office, data = ct_2012, sum)

##Cleaning original data so the merge is seamless
ct_2012$town <- ifelse(ct_2012$town == "BeaconFalls", "Beacon Falls", ct_2012$town)
ct_2012$town <- ifelse(ct_2012$town == "DeepRiver", "Deep River", ct_2012$town)
ct_2012$town <- ifelse(ct_2012$town == "EastHaddam", "East Haddam", ct_2012$town)
ct_2012$town <- ifelse(ct_2012$town == "EastHampton", "East Hampton", ct_2012$town)
ct_2008$town <- ifelse(ct_2008$town == "Litchfeld", "Litchfield", ct_2008$town)
ct_2012$town <- ifelse(ct_2012$town == "Meridien", "Meriden", ct_2012$town)
ct_2008$town <- ifelse(ct_2008$town == "New Mil!ford", "New Milford", ct_2008$town)
ct_2012$town <- ifelse(ct_2012$town == "NorthCanaan", "North Canaan", ct_2012$town)
ct_2012$town <- ifelse(ct_2012$town == "NorthStonington", "North Stonington", ct_2012$town)
ct_2012$town <- ifelse(ct_2012$town == "OldLyme", "Old Lyme", ct_2012$town)
```

```{r}
##combining rows with same town name
library(tidyverse)
ct2012 <- ct_2012 |>
  group_by(town) %>%
  mutate(row_id = row_number()) %>%
  pivot_wider(names_from = row_id, values_from = c(candidate, party, office, votes), names_prefix = "Row", values_fill = NULL) %>%
  ungroup() 

ct2012 <- ct2012 |>
  rename("2012_dem_candidate" = candidate_Row1,
         "2012_rep_candidate" = candidate_Row2,
         "2012_dem_votes" = votes_Row1,
         "2012_rep_votes" = votes_Row2) |>
  select(town, "2012_dem_candidate", "2012_dem_votes", "2012_rep_candidate", "2012_rep_votes") |>
  mutate(`2012_total` = `2012_dem_votes` + `2012_rep_votes`) |>
  mutate(`2012_repvoteshare` = `2012_rep_votes` / `2012_total`) |>
  mutate(`2012_demvoteshare` = `2012_dem_votes` / `2012_total`) 

ct2008 <- ct_2008 |>
  group_by(town) %>%
  mutate(row_id = row_number()) %>%
  pivot_wider(names_from = row_id, values_from = c(candidate, party, office, votes), names_prefix = "Row", values_fill = NULL) %>%
  ungroup() 

ct2008 <- ct2008 |>
  rename("2008_dem_candidate" = candidate_Row1,
         "2008_rep_candidate" = candidate_Row2,
         "2008_dem_votes" = votes_Row1,
         "2008_rep_votes" = votes_Row2) |>
  select(town, "2008_dem_candidate", "2008_dem_votes", "2008_rep_candidate", "2008_rep_votes") |>
  mutate(`2008_total` = `2008_dem_votes` + `2008_rep_votes`) |>
  mutate(`2008_repvoteshare` = `2008_rep_votes` / `2008_total`) |>
  mutate(`2008_demvoteshare` = `2008_dem_votes` / `2008_total`) 

##Merging
merged_CT <- merge(ct2008, ct2012, by = c("town"), all = TRUE) |>
  mutate(dif_rep_voteshare = `2012_repvoteshare` - `2008_repvoteshare`)|>
  mutate(dif_dem_voteshare = `2012_demvoteshare` - `2008_demvoteshare`) |>
  mutate(votedif = `2012_total` - `2008_total`)

##create a table with only variables of interest, voteshare difference from 2008 to 2012
CT_votes <- merged_CT |>
  select(town, dif_rep_voteshare, dif_dem_voteshare, votedif)
```

```{r}
write.table(CT_votes, file = "votesdata2.csv")
```


#Demographic data by block
```{r}
#CONNECTICUT
ct_cvap_2010 <- read.csv("ct_cvap_2010.csv")

```

